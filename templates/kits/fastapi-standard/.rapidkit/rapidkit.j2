#!/usr/bin/env bash
# Local RapidKit project launcher (Python engine)
# Delegates project commands to RapidKit core via: poetry run python -m rapidkit

set -euo pipefail
ROOT_DIR="$(cd "$(dirname "$0")/.." && pwd)"

if [ ! -f "$ROOT_DIR/pyproject.toml" ]; then
  echo "‚ùå pyproject.toml not found; are you in a RapidKit FastAPI project?"
  exit 1
fi

if ! command -v poetry >/dev/null 2>&1; then
  echo "‚ùå Poetry is required but was not found on PATH."
  echo "üí° Install Poetry: https://python-poetry.org/docs/#installation"
  exit 127
fi

cmd="${1:-}"

# Bootstrap dependencies (including rapidkit-core) into Poetry venv
if [ "$cmd" = "init" ]; then
  exec poetry -C "$ROOT_DIR" install
fi

# Run all commands through the Python core engine.
# Note: this expects `rapidkit-core` is installed in the Poetry environment.
exec poetry -C "$ROOT_DIR" run python -m rapidkit "$@"
