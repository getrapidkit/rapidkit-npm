@echo off
REM RapidKit CLI - Local project commands (Windows)
REM This wrapper delegates to .rapidkit/cli.py with smart Python detection

setlocal enabledelayedexpansion

set "SCRIPT_DIR=%~dp0"
set "CLI_PY=%SCRIPT_DIR%.rapidkit\cli.py"

REM Find the best Python to use

REM 1. Project venv
if exist "%SCRIPT_DIR%.venv\Scripts\python.exe" (
    set "PYTHON_CMD=%SCRIPT_DIR%.venv\Scripts\python.exe"
    goto :run
)

REM 2. Poetry's python
where poetry >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    for /f "tokens=*" %%i in ('poetry env info --executable 2^>nul') do set "POETRY_PY=%%i"
    if defined POETRY_PY (
        if exist "!POETRY_PY!" (
            set "PYTHON_CMD=!POETRY_PY!"
            goto :run
        )
    )
)

REM 3. System python
where python >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    set "PYTHON_CMD=python"
    goto :run
)

REM 4. py launcher (Windows Python Launcher)
where py >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    set "PYTHON_CMD=py -3"
    goto :run
)

echo.
echo ============================================================
echo   Python not found!
echo ============================================================
echo.
echo   RapidKit FastAPI projects require Python 3.11 or newer.
echo.
echo   Install Python using one of these methods:
echo.
echo   1. Microsoft Store (recommended):
echo      https://apps.microsoft.com/detail/9NRWMJP3717K
echo.
echo   2. Official installer:
echo      https://www.python.org/downloads/
echo      (Check "Add Python to PATH" during installation)
echo.
echo   3. Using winget:
echo      winget install Python.Python.3.12
echo.
echo   4. Using chocolatey:
echo      choco install python
echo.
echo   After installing, restart your terminal and try again.
echo ============================================================
echo.
exit /b 127

:run
%PYTHON_CMD% "%CLI_PY%" %*
