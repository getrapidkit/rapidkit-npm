@echo off
REM RapidKit CLI - Local project commands (Windows)
REM This wrapper delegates to .rapidkit/cli.py with smart Python detection

setlocal enabledelayedexpansion

set "SCRIPT_DIR=%~dp0"
set "CLI_PY=%SCRIPT_DIR%.rapidkit\cli.py"

REM Find the best Python to use

REM 1. Project venv
if exist "%SCRIPT_DIR%.venv\Scripts\python.exe" (
    set "PYTHON_CMD=%SCRIPT_DIR%.venv\Scripts\python.exe"
    goto :run
)

REM 2. Poetry's python
where poetry >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    for /f "tokens=*" %%i in ('poetry env info --executable 2^>nul') do set "POETRY_PY=%%i"
    if defined POETRY_PY (
        if exist "!POETRY_PY!" (
            set "PYTHON_CMD=!POETRY_PY!"
            goto :run
        )
    )
)

REM 3. System python
where python >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    set "PYTHON_CMD=python"
    goto :run
)

REM 4. py launcher (Windows Python Launcher)
where py >nul 2>&1
if %ERRORLEVEL% EQU 0 (
    set "PYTHON_CMD=py -3"
    goto :run
)

echo ‚ùå No Python interpreter found.
echo üí° Install Python 3.11+ and try again.
exit /b 127

:run
%PYTHON_CMD% "%CLI_PY%" %*
