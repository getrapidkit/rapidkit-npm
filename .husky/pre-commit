#!/usr/bin/env sh

# Type checking
echo "ğŸ” Running type check..."
npm run typecheck || exit 1

# Linting
echo "ğŸ§¹ Running linter..."
npx lint-staged || exit 1

# Format check
echo "ğŸ’… Checking code formatting..."
npm run format:check || exit 1

# Contracts sync check (only when Core schema is available)
if [ -n "${RAPIDKIT_CORE_SCHEMA_PATH:-}" ] && [ -f "${RAPIDKIT_CORE_SCHEMA_PATH}" ]; then
	echo "ğŸ”— Checking Core â†” NPM contracts..."
	npm run check:contracts || exit 1
elif [ -f "../core/docs/contracts/rapidkit-cli-contracts.json" ]; then
	echo "ğŸ”— Checking Core â†” NPM contracts (monorepo)..."
	RAPIDKIT_CORE_SCHEMA_PATH="../core/docs/contracts/rapidkit-cli-contracts.json" npm run check:contracts || exit 1
elif [ -f "../../core/docs/contracts/rapidkit-cli-contracts.json" ]; then
	echo "ğŸ”— Checking Core â†” NPM contracts (monorepo)..."
	RAPIDKIT_CORE_SCHEMA_PATH="../../core/docs/contracts/rapidkit-cli-contracts.json" npm run check:contracts || exit 1
else
	echo "â„¹ï¸ Skipping contracts check (core schema not found)"
fi

# Tests
echo "ğŸ§ª Running tests..."
npm test || exit 1

echo "âœ… All checks passed!"
